<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP MENU TH·∫¨P C·∫®M ADR&PC | vinhmodlag.store</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #00f2ff; --accent: #ff0055; --bg: #0d1117; --card: #161b22; --text: #c9d1d9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: var(--primary); color: #000; }
        .btn-google { background: white; color: #000; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* AUTH SYSTEM */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; justify-content: center; align-items: center; z-index: 10000; }
        .auth-box { background: var(--card); padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #30363d; }
        .auth-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; color: #8b949e; }
        .tab.active { color: var(--primary); border-bottom: 2px solid var(--primary); font-weight: bold; }
        .step { display: none; } .step.active { display: block; }

        /* DASHBOARD */
        header { background: var(--card); padding: 15px 5%; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index: 100; }
        .balance-tag { background: #238636; padding: 6px 15px; border-radius: 20px; font-weight: bold; }
        .container { max-width: 1100px; margin: auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid #30363d; position: relative; }
        .stock { position: absolute; top: 15px; right: 15px; font-size: 11px; color: var(--primary); border: 1px solid var(--primary); padding: 2px 6px; border-radius: 4px; }
        .time-select { display: flex; gap: 5px; margin-bottom: 15px; }
        .t-btn { flex: 1; padding: 8px; font-size: 12px; background: #0d1117; color: white; border: 1px solid #30363d; border-radius: 5px; cursor: pointer; }
        .t-btn.active { background: var(--primary); color: #000; }
        #admin-panel { display: none; background: #1c0a0a; border: 2px dashed var(--accent); padding: 20px; border-radius: 12px; margin-bottom: 30px; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-box">
            <h2 style="text-align:center; color: var(--primary);">vinhmodlag.store</h2>
            <div class="auth-tabs">
                <div class="tab active" id="tab-login" onclick="setAuth('login')">ƒêƒÉng Nh·∫≠p</div>
                <div class="tab" id="tab-reg" onclick="setAuth('reg')">ƒêƒÉng K√Ω</div>
            </div>

            <div id="form-login" class="step active">
                <input type="text" id="l-user" placeholder="Email ho·∫∑c S·ªë ƒëi·ªán tho·∫°i">
                <input type="password" id="l-pass" placeholder="M·∫≠t kh·∫©u">
                <button class="btn btn-main" onclick="doLogin()">ƒêƒÇNG NH·∫¨P</button>
            </div>

            <div id="form-reg" class="step">
                <div id="reg-s1" class="step active">
                    <p style="font-size: 12px;">B∆Ø·ªöC 1: NH·∫¨P GMAIL HO·∫∂C SƒêT</p>
                    <input type="text" id="r-id" placeholder="Nh·∫≠p Gmail ho·∫∑c SƒêT">
                    <button class="btn btn-main" onclick="goReg(2)">TI·∫æP THEO</button>
                </div>
                <div id="reg-s2" class="step">
                    <p style="font-size: 12px;">B∆Ø·ªöC 2: ƒê·∫∂T M·∫¨T KH·∫®U</p>
                    <input type="password" id="r-p1" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                    <input type="password" id="r-p2" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u">
                    <button class="btn btn-main" onclick="doRegister()">HO√ÄN TH√ÄNH</button>
                    <button class="btn" style="background:none; font-size:12px;" onclick="goReg(1)">Quay l·∫°i</button>
                </div>
            </div>

            <div style="text-align: center; margin: 15px 0; font-size: 12px; color: #484f58;">HO·∫∂C</div>
            <button class="btn btn-google" onclick="doGoogle()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> ƒêƒÉng nh·∫≠p Google
            </button>
        </div>
    </div>

    <div id="main-shop" style="display: none;">
        <header>
            <h3 style="margin:0; color:var(--primary)">MENU TH·∫¨P C·∫®M</h3>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="balance-tag">üí∞ <span id="u-bal">0</span>ƒë</div>
                <button onclick="logout()" style="background:none; border:none; color:var(--accent); font-weight:bold; cursor:pointer;">THO√ÅT</button>
            </div>
        </header>

        <div class="container">
            <div id="admin-panel">
                <h3 style="color: var(--accent); margin-top:0;">üõ† QU·∫¢N TR·ªä: HO√ÄNG VINH</h3>
                <div id="admin-inputs"></div>
            </div>

            <div class="card" style="margin-bottom: 30px;">
                <h3 style="color: #238636; margin-top:0;">üí≥ N·∫†P TH·∫∫ C√ÄO</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <select id="c-type"><option>VIETTEL</option><option>ZING</option><option>MOBIFONE</option></select>
                    <select id="c-val"><option value="10000">10.000ƒë</option><option value="50000">50.000ƒë</option><option value="100000">100.000ƒë</option></select>
                    <input type="text" id="c-seri" placeholder="Seri">
                    <input type="text" id="c-pin" placeholder="M√£ th·∫ª">
                </div>
                <button class="btn btn-main" onclick="naptien()">N·∫†P TH·∫∫</button>
            </div>
            <div class="grid" id="product-grid"></div>
        </div>
    </div>

    <script>
        // C·∫§U H√åNH FIREBASE - THAY B·∫∞NG M√É C·ª¶A B·∫†N
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            authDomain: "vinhmodlag.firebaseapp.com",
            databaseURL: "https://vinhmodlag.firebaseio.com",
            projectId: "vinhmodlag",
            appId: "1:xxx:web:xxx"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let isAdmin = false; let uKey = "";
        const catalog = [
            { id: 'acc', name: 'ACC CLONE LV 5 FREEFIRE', isTime: false },
            { id: 'br', name: 'MENU BR MOD AD&PC', isTime: true },
            { id: 'lag', name: 'FAKE LAG ADR', isTime: true }
        ];

        // --- AUTH LOGIC (FIXED) ---
        function setAuth(m) {
            document.getElementById('form-login').style.display = (m==='login'?'block':'none');
            document.getElementById('form-reg').style.display = (m==='reg'?'block':'none');
            document.getElementById('tab-login').classList.toggle('active', m==='login');
            document.getElementById('tab-reg').classList.toggle('active', m==='reg');
        }

        function goReg(s) {
            document.getElementById('reg-s1').style.display = (s===1?'block':'none');
            document.getElementById('reg-s2').style.display = (s===2?'block':'none');
        }

        function formatEmail(id) {
            return id.includes('@') ? id : id + "@vinhmodlag.store"; // Fix l·ªói ƒë·ªãnh d·∫°ng Firebase
        }

        function doRegister() {
            const id = document.getElementById('r-id').value.trim();
            const p1 = document.getElementById('r-p1').value;
            const p2 = document.getElementById('r-p2').value;
            if(p1 !== p2) return alert("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!");
            if(p1.length < 6) return alert("M·∫≠t kh·∫©u ph·∫£i √≠t nh·∫•t 6 k√Ω t·ª±!");

            auth.createUserWithEmailAndPassword(formatEmail(id), p1).then(() => {
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng! Quay l·∫°i ƒëƒÉng nh·∫≠p.");
                setAuth('login');
            }).catch(e => alert("L·ªói: " + e.message));
        }

        function doLogin() {
            const u = document.getElementById('l-user').value.trim();
            const p = document.getElementById('l-pass').value;

            if(u === "HoangVinh" && p === "HV0308hv") {
                isAdmin = true; uKey = "admin_vinh";
                loadShop(); return;
            }

            // L∆∞u m·∫≠t kh·∫©u t·ª± ƒë·ªông v√†o sever browser
            auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(() => {
                return auth.signInWithEmailAndPassword(formatEmail(u), p);
            }).catch(e => alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!"));
        }

        function doGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' }); // Hi·ªán b·∫£ng ch·ªçn Gmail
            auth.signInWithPopup(provider);
        }

        auth.onAuthStateChanged(user => {
            if(user) { uKey = user.uid; loadShop(); }
        });

        function loadShop() {
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('main-shop').style.display = 'block';
            if(isAdmin) document.getElementById('admin-panel').style.display = 'block';
            db.ref('users/' + uKey + '/bal').on('value', s => {
                document.getElementById('u-bal').innerText = (s.val() || 0).toLocaleString();
            });
            render();
        }

        function render() {
            const grid = document.getElementById('product-grid');
            const adm = document.getElementById('admin-inputs');
            grid.innerHTML = ""; adm.innerHTML = "";

            catalog.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="stock">C√≤n: <span id="s-${item.id}">0</span></div>
                    <h3>${item.name}</h3>
                    ${item.isTime ? `<div class="time-select">
                        <button class="t-btn active" onclick="selT('${item.id}',1,this)">1 Day</button>
                        <button class="t-btn" onclick="selT('${item.id}',7,this)">7 Day</button>
                        <button class="t-btn" onclick="selT('${item.id}',30,this)">30 Day</button>
                    </div>` : ''}
                    <div style="font-size:24px; color:var(--primary); font-weight:bold;" id="p-${item.id}">0ƒë</div>
                    <button class="btn btn-main" onclick="buy('${item.id}')">THANH TO√ÅN</button>
                `;
                grid.appendChild(card);

                if(isAdmin) {
                    const row = document.createElement('div');
                    row.style.borderBottom = "1px solid #333; padding: 10px 0";
                    row.innerHTML = `<b>${item.name}</b> | Kho: <input id="as-${item.id}" style="width:50px"> 
                        Gi√°: <input id="ap-${item.id}" style="width:70px"> <button onclick="save('${item.id}')">L∆∞u</button>`;
                    adm.appendChild(row);
                }

                db.ref('prods/' + item.id).on('value', s => {
                    const d = s.val() || {p1:0, p7:0, p30:0, stock:0};
                    window['sel_'+item.id] = 1;
                    document.getElementById('s-'+item.id).innerText = d.stock;
                    updateUI(item.id, d, item.isTime);
                });
            });
        }

        function selT(id, d, btn) {
            btn.parentElement.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active'); window['sel_'+id] = d;
            db.ref('prods/' + id).once('value', s => updateUI(id, s.val(), true));
        }

        function updateUI(id, data, isTime) {
            const p = isTime ? data['p'+window['sel_'+id]] : data.p1;
            document.getElementById('p-'+id).innerText = parseInt(p).toLocaleString() + "ƒë";
        }

        function save(id) {
            const d = { stock: document.getElementById('as-'+id).value, p1: document.getElementById('ap-'+id).value, p7: 50000, p30: 150000 };
            db.ref('prods/' + id).update(d).then(() => alert("ƒê√£ l∆∞u!"));
        }

        function naptien() {
            const pin = document.getElementById('c-pin').value;
            const val = parseInt(document.getElementById('c-val').value);
            if(!pin) return;
            db.ref('cards/' + pin).once('value', s => {
                if(s.exists()) return alert("Th·∫ª ƒë√£ d√πng!");
                db.ref('cards/' + pin).set(true);
                db.ref('users/' + uKey + '/bal').once('value', v => {
                    db.ref('users/' + uKey + '/bal').set((v.val() || 0) + val);
                    alert("N·∫°p th√†nh c√¥ng!");
                });
            });
        }

        function buy(id) {
            if(isAdmin) return alert("Admin d√πng mi·ªÖn ph√≠!");
            db.ref('prods/' + id).once('value', s => {
                const data = s.val(); if(data.stock <= 0) return alert("H·∫øt h√†ng!");
                const cost = catalog.find(x=>x.id===id).isTime ? data['p'+window['sel_'+id]] : data.p1;
                db.ref('users/' + uKey + '/bal').once('value', v => {
                    if(v.val() >= cost) {
                        db.ref('users/' + uKey + '/bal').set(v.val() - cost);
                        db.ref('prods/' + id + '/stock').set(data.stock - 1);
                        alert("Mua th√†nh c√¥ng!");
                    } else alert("Kh√¥ng ƒë·ªß ti·ªÅn!");
                });
            });
        }
        function logout() { auth.signOut().then(() => location.reload()); }
    </script>
</body>
</html>
